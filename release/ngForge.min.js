/*!
 * Copyright 2015 Thinking Bytes Ltd.
 *
 * ngForge, v0.2.0
 * Angular wrappers for Trigger.io (forge) modules.
 * http://trigger.io/
 * http://angularjs.org/
 *
 * By @arolave <3
 *
 * Licensed under the MIT license. Please see LICENSE for more information.
 *
 */

!function(){angular.module("ngForge",[]),angular.module("ngForge").factory("forge",["$http","$interval","$window","logger","ngForgeConfig",function(e,n,t,r,o){var i={dummy:!0,is:{web:function(){return!0},mobile:function(){return!1},android:function(){return!1},ios:function(){return!1},connection:{_connected:!1,connected:function(){return this._connected},wifi:function(){return this._connected}}},event:{messagePushed:{addListener:function(e,n){return void 0}},appPaused:{addListener:function(e,n){return void 0}},appResumed:{addListener:function(e,n){return void 0}},backPressed:{addListener:function(e,n){return void 0},preventDefault:function(e,n){return void 0}},connectionStateChange:{listeners:[],addListener:function(e,n){return void this.listeners.push(e)}}},testConnection:function(){var n;return n=function(e){return function(n){return e.is.connection._connected=n,e.event.connectionStateChange.listeners.forEach(function(e){return e()})}}(this),e.get(o.testConnectionUrl).then(function(e){return function(){return e.is.connection._connected?void 0:n(!0)}}(this))["catch"](function(e){return function(){return e.is.connection._connected?n(!1):void 0}}(this))}};return t.forge?(r.info("ngForge.$forge: using trigger.io"),t.forge):(r.info("ngForge.$forge: using dummy"),i.testConnection(),n(function(){return i.testConnection()},5e3),i)}]),angular.module("ngForge").provider("$forgeContact",function(){"use strict";return{$get:["$injector","$q","forge","logger","ngForgeUtils","ngForgeConfig",function(e,n,t,r,o,i){var u;return u={select:function(e,n){return r.debug("select"),"function"==typeof e?e():void 0},selectAll:function(e,n,t){return o.isFunction(e)&&(e=["id","displayName"],n=e,t=n),r.debug("selectAll"),"function"==typeof n?n(i.sampleContacts.map(function(n){return o.pick(n,e)})):void 0},selectById:function(e,n,t){return r.debug("selectById"),"function"==typeof n?n(o.find(i.sampleContacts,function(n){return n.id===e})):void 0}},o.liftObject(t.dummy?u:t.contact)}]}}),angular.module("ngForge").provider("$forgeFacebook",function(){"use strict";return{$get:["$injector","forge","logger","ngForgeConfig","ngForgeUtils",function(e,n,t,r,o){var i;return i={authorize:function(e,n,t,r){return t({access_token:"dfs",access_expires:"never",granted:!0,denied:!1})},hasAuthorized:function(e,n,t,r){return t({access_token:"dfs",access_expires:"never",granted:!1,denied:!1})},logout:function(e,n){return e()},api:function(e,n,t,r,o){return r(!0)},ui:function(e,n,t){return n(!0)},installed:function(e,n){return e(!0)},getKeyHash:function(e,n){return e(r.facebookKeyHash)}},o.liftObject(n.dummy?i:n.facebook)}]}}),angular.module("ngForge").provider("$forgeFile",function(){"use strict";return{$get:["$injector","$q","forge","ngForgeUtils",function(e,n,t,r){var o,i;return o={isFile:function(e,n){return n(!!(null!=e?e.uri:void 0))},getLocal:function(e,n){return n({uri:e})},cacheURL:function(e,n,t){return n({uri:e})},URL:function(e,n){return n(e.uri)},remove:function(e,n){return n()}},i=t.dummy?o:t.file,r.liftObject(i)}]}}),angular.module("ngForge").provider("$forgeHttp",["$httpProvider",function(e){"use strict";return{$get:["$http","$injector","$q","$rootScope","forge","logger","ngForgeUtils",function(e,n,t,r,o,i,u){return o.dummy?this.ngHttp(e,i):this.forgeHttp(e,n,t,r,o,u,i)}],httpProvider:e,ngHttp:function(e,n){return n.debug("using $http for comms"),{request:function(n){return e(n)},get:function(t,r){return n.log("ngget:"+t),e.get(t,r)},jsonp:function(t,r){return n.log("ngjsonp:"+t),e.jsonp(t,r)},post:function(t,r,o){return n.log("ngpost:"+t+":"+r),e.post(t,r,o)},put:function(t,r,o){return n.log("ngput:"+t+":"+r),e.put(t,r,o)},"delete":function(t,r){return n.log("ngdelete:"+t),e["delete"](t,r)}}},forgeHttp:function(e,n,t,r,o,i,u){var a;return u.debug("using forge for comms"),a=[],angular.forEach(this.httpProvider.interceptors,function(e){return a.unshift(angular.isString(e)?n.get(e):n.invoke(e))}),{request:function(e){return this._basicRequest(e.method,e.url,e)},get:function(e,n){return this._getRequest(e,n)},post:function(e,n,t){return this._basicRequest("post",e,t,n)},put:function(e,n,t){return this._basicRequest("put",e,t,n)},patch:function(e,n,t){return this._basicRequest("patch",e,t,n)},"delete":function(e,n){return this._basicRequest("delete",e,n)},jsonp:function(e,n){return this._basicRequest("jsonp",e,n)},_getRequest:function(e,n){var r,o,a,f,c,s,l,g;if(u.info("_getRequest("+e+", "+JSON.stringify(n)+")"),a=t.defer(),s=a.promise,i.isObject(null!=n?n.cache:void 0)&&(r=null!=n?n.cache:void 0),c=function(e){return e>=200&&300>e},l=function(e,t,r,o){return t=Math.max(t,0),(c(t)?a.resolve:a.reject)({data:e,status:t,headers:r,config:n,statusText:o})},g=function(e){return l(e.data,e.status,i.safeClone(e.headers),e.statusText)},r){if(o=r.get(e),null!=o)return i.isFunction(o.then)?o.then(g,g):Array.isArray(o)?l(o[1],o[0],i.safeClone(o[2]),o[3]):l(o,200,{},"OK"),s;r.put(e,s)}return f=function(n){return r&&(c(n.status)?r.put(e,[n.status,n.data,n.headers,n.statusText]):r.remove(e)),g(n)},this._basicRequest("get",e,n).then(f,f),s},_forgeRequester:function(e){var n;return u.info("_forgeRequester"),n=t.defer(),e.success=function(t,o){return u.debug("ngForge.$forgeHttp.success: "+JSON.stringify(t)),n.resolve({status:200,data:t,headers:o,config:e}),r.$$phase?void 0:r.$apply()},e.error=function(e){var t,o;u.debug("error "+JSON.stringify(e)),u.error(e.statusCode+" "+e.content),o=400;try{o=parseInt(e.statusCode)}catch(i){}t=e.content;try{t=JSON.parse(e.content)}catch(i){}return n.reject({status:o,data:t,headers:{}}),r.$$phase?void 0:r.$apply()},o.request.ajax(e),n.promise},_basicRequest:function(n,t,r,o){var i,u,a;return i=function(e,n){var t,r;return t=angular.extend(n||{},{contentType:"application/json; charset=utf-8",accepts:["application/json"],type:e.method.toUpperCase()}),e.file?t.files=[e.file]:t.dataType=e.responseType||"json",r=angular.extend(e||{},t),delete r.file,r},u=angular.extend(r||{},{method:n,url:t}),"jsonp"===n?e.jsonp(t,u):(a=o?{data:JSON.stringify(o)}:r&&r.params?{data:r.params}:void 0,this._doRequest(i(u,a)))},_doRequest:function(e){var n,r,o,i;for(u.log("forge"+e.method.toLowerCase()+":"+e.url+":"+((null!=e?e.data:void 0)?JSON.stringify(e.data):void 0)),r=t.when(forgeOptions),n=[this._forgeRequester,void 0],angular.forEach(a,function(e){return(e.request||e.requestError)&&n.unshift(e.request,e.requestError),e.response||e.responseError?n.push(e.response,e.responseError):void 0});n.length;)i=n.shift(),o=n.shift(),r=r.then(i,o);return r.success=function(n){return r.then(function(t){return n(t.data,t.status,t.headers,e)}),r},r.error=function(n){return r["catch"](function(t){var r,o;return o=function(){try{return JSON.parse(t.data)}catch(e){return r=e,t.data}}(),n(o,t.status,t.headers,e)}),r},r}}}}}]),angular.module("ngForge").provider("$forgeIonicKeyboard",function(){"use strict";return{$get:["$injector","$q","forge","logger","ngForgeUtils",function(e,n,t,r,o){var i;return i={disableScroll:function(e,n){return r.info("$forgeIonicKeyboard.disableScroll("+e+")"),"function"==typeof n?n():void 0},hideKeyboardAccessoryBar:function(e,n){return r.info("$forgeIonicKeyboard.hideKeyboardAccessoryBar("+e+")"),"function"==typeof n?n():void 0},isKeyboardVisible:function(e){return r.info("$forgeIonicKeyboard.isKeyboardVisible"),"function"==typeof e?e():void 0},close:function(e){return r.info("$forgeIonicKeyboard.close"),"function"==typeof e?e():void 0}},o.liftObject(t.dummy?i:t.ionic_keyboard)}]}}),angular.module("ngForge").factory("logger",["ngForgeUtils",function(e){var n,t,r,o,i,u;return window.forge&&window.forge.is&&window.forge.is.mobile()?(n=function(n){var t,r;return n=Array.prototype.slice.call(n),t=e.filter(n,function(e){return e&&e instanceof Error}),t&&t.length?r=t[0]:void 0},u=function(e){return Array.prototype.slice.call(e).toString()},o=[],t=function(e){return i("â–¾ "+e),o.push(e)},r=function(){return o.pop()},i=function(e,n,r){var o,i,u,a;for(null==r&&(r=forge.logging.log),u="",o=i=0,a=t.length;a>=0?a>=i:i>=a;o=a>=0?++i:--i)u+="| ";return forge.logging.log(""+u+e,n)},{log:function(){return i(u(arguments),n(arguments))},debug:function(){return i(u(arguments),n(arguments),forge.logging.debug)},info:function(){return i(u(arguments),n(arguments),forge.logging.info)},warn:function(){return i(u(arguments),n(arguments),forge.logging.warn)},error:function(){return i(u(arguments),n(arguments),forge.logging.error)},critical:function(){return i(u(arguments),n(arguments),forge.logging.critical)},group:t,groupCollapsed:t,groupEnd:r}):console}]),angular.module("ngForge").provider("$forgeMedia",function(){"use strict";return{$get:["$injector","$q","forge","logger","ngForgeUtils",function(e,n,t,r,o){var i;return i={playerDummy:{play:function(e){return"function"==typeof e?e():void 0}},createAudioPlayer:function(e,n,t){return r.info("create dummy player "+e),"function"==typeof n?n(this.playerDummy):void 0}},o.liftObject(t.dummy?i:t.media)}]}}),angular.module("ngForge").provider("$forgeParse",function(){"use strict";return{$get:["$injector","$q","forge","logger","ngForgeUtils",function(e,n,t,r,o){var i;return i={dummyChannels:[""],installationInfo:function(e){return r.info("parseDummy info"),e({id:-696969})},registerForNotifications:function(e,n){return e()},push:{subscribe:function(e,n,t){return r.info("subscribing to "+e),o.includes(this.dummyChannels,e)||this.dummyChannels.push(e),"function"==typeof n?n():void 0},unsubscribe:function(e,n,t){return r.info("unsubscribing from "+e),this.dummyChannels=o.without(this.dummyChannels,e),"function"==typeof n?n():void 0},subscribedChannels:function(e,n){return"function"==typeof e?e(this.dummyChannels):void 0}}},o.liftObject(t.dummy?i:t.parse)}]}}),angular.module("ngForge").provider("$forgePlatform",function(){"use strinct";return{$get:["$injector","$q","forge","ngForgeUtils",function(e,n,t,r){var o,i;return i={getModel:function(e,n){return e("X")},getVersion:function(e,n){return e("1")},getAPILevel:function(e,n){return e("1")},getManufacturer:function(e,n){return e("X")}},o=t.dummy?i:t.platform,r.liftObject(o)}]}}),angular.module("ngForge").provider("$forgePrefs",function(){"use strict";return{$get:["$injector","$q","$window","forge","logger","ngForgeConfig","ngForgeUtils",function(e,n,t,r,o,i,u){var a,f,c;return c=function(e){return t.localStorage.setItem(i.prefsKey,JSON.stringify(e))},a=function(){var e;return e=t.localStorage.getItem(i.prefsKey),e&&(e=JSON.parse(e)),e||(e={},c(e)),e},f={get:function(e,n,t){var r;try{return"function"==typeof n?n(a()[e]):void 0}catch(i){r=i,o.error(r.message),"function"==typeof t&&t(r)}},set:function(e,n,t,r){var i,u;try{return u=a(),u[e]=n,c(u),"function"==typeof t?t():void 0}catch(f){return i=f,o.error(i.message),"function"==typeof r?r(i):void 0}},clear:function(e,n,t){var r,i;try{return i=a(),delete i[e],c(i),"function"==typeof n?n():void 0}catch(u){return r=u,o.error(r.message),"function"==typeof t?t(r):void 0}},clearAll:function(e,n){var t;try{return c({}),"function"==typeof e?e():void 0}catch(r){return t=r,o.error(t.message),"function"==typeof n?n(t):void 0}},keys:function(e,n){var t,r;try{return r=a(),e(Object.keys(r))}catch(i){return t=i,o.error(t.message),n(t)}}},u.liftObject(r.dummy?f:r.prefs)}]}}),angular.module("ngForge").provider("$forgeSegmentio",function(){"use strict";return{$get:["$injector","$q","forge","logger","ngForgeUtils",function(e,n,t,r,o){var i;return i={identify:function(e,n,t,o){return r.debug("identify"),"function"==typeof t?t():void 0},track:function(e,n,t,o){return r.debug("track"),"function"==typeof t?t():void 0},screen:function(e,n,t,o){return r.debug("screen"),"function"==typeof t?t():void 0}},o.liftObject(t.dummy?i:t.segmentio)}]}}),angular.module("ngForge").provider("$forgeSms",function(){"use strict";return{$get:["$injector","$q","forge","logger","ngForgeUtils",function(e,n,t,r,o){var i;return i={send:function(e,n,t){return r.debug("$forgeSms.send "+e.body+" to "+JSON.stringify(e.to)),"function"==typeof n?n():void 0}},o.liftObject(t.dummy?i:t.sms)}]}}),angular.module("ngForge").constant("ngForgeConfig",{testConnectionUrl:"ping",facebookKeyHash:"5453425284625867",prefsKey:"ngStorage-prefs",sampleContacts:[{id:"14894",displayName:"Gal Gadot",name:{formatted:"Gal Gadot",familyName:"Gadot",givenName:"Gal",middleName:null,honorificPrefix:"",honorificSuffic:null},nickname:"",phoneNumbers:[{value:"+447574712444",type:"mobile",pref:!1}],photos:[{value:"data:image/jpg;base64,ABCDEF1234",type:null,pref:!1}]},{id:"148900",displayName:"Tom",name:{formatted:"Tom",familyName:"",givenName:"Tom",middleName:null,honorificPrefix:"",honorificSuffic:null},nickname:"",phoneNumbers:[{value:"+44 751-5097756+13",type:"mobile",pref:!1}],photos:[{value:"data:image/jpg;base64,ABCDEF1234",type:null,pref:!1}]},{id:"14894",displayName:"Brigid",name:{formatted:"Brigid",familyName:"",givenName:"Brigid",middleName:null,honorificPrefix:"",honorificSuffic:null},nickname:"",phoneNumbers:[{value:"+33 7817471244",type:"mobile",pref:!1}],photos:[{value:"data:image/jpg;base64,ABCDEF1234",type:null,pref:!1}]},{id:"14895",displayName:"Eddie Redmayne",name:{formatted:"Eddie Redmayne",familyName:"Fenech",givenName:"Eddie",middleName:null,honorificPrefix:"",honorificSuffic:null},nickname:"",phoneNumbers:[{value:"+447432111412",type:"mobile",pref:!1}],photos:[{value:"data:image/jpg;base64,ABCDEF1234",type:null,pref:!1}]},{id:"122",displayName:"Arow",name:{formatted:"Arow",familyName:"Arow"},nickname:"",phoneNumbers:[{value:"+972 963587331",type:"mobile",pref:!1}]},{id:"299",displayName:"Bad Phone",name:{formatted:"Bad Phone",familyName:"BPhone"},nickname:"",phoneNumbers:[{value:"+97288898",type:"mobile",pref:!1}]},{id:"1",displayName:"Girt Wenders",name:{formatted:"Girt Wenders",familyName:"Wenders",givenName:"Girt",middleName:null,honorificPrefix:"",honorificSuffic:null},nickname:"",phoneNumbers:[{value:"+972 521123241",type:"mobile",pref:!1}]},{id:"690",displayName:"Dodgy Bro",name:{formatted:"Dodgy Bro",familyName:"Bro",givenName:"Dodgy",middleName:null,honorificPrefix:"",honorificSuffic:null},nickname:"Doge",phoneNumbers:[{value:"+44 7967929796",type:"mobile",pref:!1}]},{id:"691",displayName:"Toby Bro",name:{formatted:"Toby Bro",familyName:"Bro",givenName:"Toby",middleName:null,honorificPrefix:"",honorificSuffic:null},nickname:"Tobe",phoneNumbers:[{value:"+44-783-241324",type:"work",pref:!1}]},{id:"2",displayName:"Mr Bodie Carstairs",name:{formatted:"Bodie Carstairs",familyName:"Carstairs",givenName:"Bodie",middleName:null,honorificPrefix:"",honorificSuffic:null},nickname:"Bo",phoneNumbers:[{value:"+447321123324",type:"mobile",pref:!1}],photos:[{value:"data:image/jpg;base64,ABCDEF1234",type:null,pref:!1}]},{id:"3",displayName:"Lucy Cleaner",name:{formatted:"Lucy Cleaner",familyName:"Cleaner",givenName:"Lucy",middleName:"middle",honorificPrefix:"",honorificSuffic:null},nickname:"",phoneNumbers:[{value:"+447321132131",type:"mobile",pref:!1}],photos:[{value:"data:image/jpg;base64,ABCDEF1234",type:null,pref:!1}]},{id:"33",displayName:"Ches",name:{formatted:"Ches",familyName:"",givenName:"Ches",middleName:"",honorificPrefix:"",honorificSuffic:null},nickname:"",phoneNumbers:[{value:"0543742342",type:"mobile",pref:!1}],photos:[{value:"data:image/jpg;base64,ABCDEF1234",type:null,pref:!1}]},{id:"4",displayName:"Sarah",name:{formatted:"Sarah",familyName:"",givenName:"Sarah",middleName:null,honorificPrefix:"",honorificSuffic:null},nickname:"tush",phoneNumbers:[{value:"+972547434302",type:"work",pref:!1},{value:"+335723131231",type:"home",pref:!1},{value:"+447312311232",type:"mobile",pref:!1}],photos:[{value:"data:image/jpg;base64,ABCDEF1234",type:null,pref:!1}]}]}),angular.module("ngForge").factory("ngForgeUtils",["$q",function(e){"use strict";var n=[].slice,t={}.hasOwnProperty;return{funcTag:"[object Function]",genTag:"[object GeneratorFunction]",filter:function(e,n){var t,r,o,i;if(!e)return void 0;for(t=[],r=0,o=e.length;o>r;r++)i=e[r],n(i)&&t.push(i);return t},find:function(e,n){var t,r,o;if(!e)return void 0;for(t=0,r=e.length;r>t;t++)if(o=e[t],n(o))return o;return void 0},includes:function(e,n){var t,r,o;if(!e)return void 0;for(t=0,r=e.length;r>t;t++)if(o=e[t],o===n)return!0;return!1},isFunction:function(e){var n;return n=this.isObject(e)?Object.prototype.toString.call(e):"",n===this.funcTag||n===this.genTag},isObject:function(e){var n;return n=typeof e,"object"===n||"function"===n},lift:function(t,r){return function(){var o,i,u,a,f;return i=1<=arguments.length?n.call(arguments,0):[],u=e.defer(),f=function(){return arguments&&1===arguments.length?u.resolve(arguments[0]):u.resolve(arguments)},a=function(){return arguments&&1===arguments.length?u.reject(arguments[0]):u.reject(arguments)},o=i.concat([f,a]),r.apply(t,o),u.promise}},liftGlobalFn:function(e){return this.lift(null,e)},liftObject:function(e){var n,r,o;if(n={},!e)return n;for(r in e)t.call(e,r)&&(o=e[r],o=e[r],n[r]=this.isFunction(o)?n[r]=this.lift(e,o):this.isObject(o)?this.liftObject(o):o);return n},mapValues:function(e,n){var t,r,o,i,u;if(t={},!e)return t;for(u=Object.keys(e),r=0,i=u.length;i>r;r++)o=u[r],t[o]=n(e[o]);return t},pick:function(e,n){var t,r,o,i;if(!e)return e;for(t={},r=0,i=n.length;i>r;r++)o=n[r],t[o]=e[o];return t},safeClone:function(e){return e?JSON.parse(JSON.stringify(e)):void 0},without:function(e,n){var t,r,o,i;if(!e)return e;for(t=[],r=0,o=e.length;o>r;r++)i=e[r],i!==n&&t.push(i);return t}}}])}();